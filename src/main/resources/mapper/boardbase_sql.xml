<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="boardbase_sql">
	
	<select id="select_all" resultType="boardbase">
		SELECT 
			board.id, 
			board.creatorId,
			user.name as writerName,
			user.kImageUrl as writerPhotoUrl, 
			user.patientId as patientId,
			user.userType as userType,
			user.userLevel as userLevel,
			board.text, 
			board.createdTime,
			board.updatedTime,
			board.patientId,
			board.status,
			board.type,
			board.expireDate,
			board.accessLevel,
			Count(reply.id) AS replyCount
		FROM Board_main board
		LEFT JOIN Board_reply AS reply ON reply.boardId = board.id
		LEFT JOIN User AS user ON user.id = board.creatorId
		<where>
			user.userLevel >= board.accessLevel
		</where>
		GROUP BY board.id
		limit ${from}, ${pageSize}
		
	</select>
	
	<select id="select_one" parameterType="boardbase" resultType="boardbase">
		select 
			*
		from Board_main board
		<where>
			board.id = ${id}
		</where>
	</select>
	<select id="count" parameterType="boardbase" resultType="int">
		select
			count(*)
		FROM Board_main board

		LEFT JOIN User AS user ON user.id = board.creatorId
		<where>
			user.userLevel >= board.accessLevel
		</where>
	</select>
	
	<insert id="insert" parameterType="boardbase">
		INSERT INTO Board_main 
			(creatorId, patientId, status, text, type, accessLevel)
		values
			(${creatorId}, ${patientId}, ${status},'${text}', ${type}, ${accessLevel})
	</insert>
	
</mapper>
